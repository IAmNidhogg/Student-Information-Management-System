# 学生信息管理系统 (Student Information Management System, SIMS)

## 📋 目录

- [项目背景](#项目背景)
- [需求分析](#需求分析)
- [实现原理](#实现原理)
- [实现方法](#实现方法)
- [项目结构](#项目结构)
- [编译与运行](#编译与运行)
- [使用指南](#使用指南)
- [功能说明](#功能说明)
- [技术特性](#技术特性)
- [文件说明](#文件说明)

---

## 🎯 项目背景

学生信息管理系统（SIMS）是一个基于 C++ 开发的命令行应用程序，旨在为教育机构提供高效、可靠的学生信息管理解决方案。系统支持学生信息的增删改查、数据排序、统计分析、批量操作以及数据持久化等功能。

该系统采用面向对象的设计思想，使用 C++11 标准开发，具有良好的可扩展性和维护性。系统支持二进制和 JSON 两种数据格式的存储，确保数据的安全性和可移植性。

---

## 📝 需求分析

### 核心功能需求

1. **学生信息管理**
   - 添加新学生信息
   - 删除学生信息
   - 更新学生信息
   - 查询学生信息（支持多种查询方式）

2. **数据查询功能**
   - 按学号查询（支持模糊搜索）
   - 按姓名查询（支持模糊搜索）
   - 按年龄范围查询
   - 按成绩范围查询

3. **数据排序功能**
   - 按学号排序（升序/降序）
   - 按姓名排序（升序/降序）
   - 按年龄排序（升序/降序）
   - 按成绩排序（升序/降序）

4. **统计分析功能**
   - 学生总数统计
   - 平均成绩计算
   - 最高成绩查询
   - 最低成绩查询

5. **数据持久化**
   - 二进制格式存储（.dat 文件）
   - JSON 格式存储（.json 文件）
   - 自动保存和加载

6. **批量操作**
   - 批量添加学生（支持多线程）
   - 遍历所有学生信息

---

## 🔧 实现原理

### 架构设计

系统采用三层架构设计：

```
┌─────────────────────────────────────┐
│         用户界面层 (UI Layer)        │
│      (main.cpp, msystem.cpp)        │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│        业务逻辑层 (Business Layer)   │
│        (manager.cpp, manager.hpp)   │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│        数据模型层 (Data Layer)       │
│      (student.cpp, student.hpp)     │
└─────────────────────────────────────┘
```

### 核心类设计

#### 1. `student` 类
- **职责**：封装单个学生的信息
- **属性**：
  - `id_`: 学号（唯一标识）
  - `name_`: 姓名
  - `age_`: 年龄
  - `score_`: 成绩
  - `classType_`: 班级类型（CLASS_A 到 CLASS_F）
- **方法**：提供 getter/setter 方法和显示功能

#### 2. `Manager` 类
- **职责**：管理所有学生信息，提供业务逻辑接口
- **核心特性**：
  - 使用 `std::vector<student>` 存储学生数据
  - 使用 `std::mutex` 保证线程安全
  - 提供增删改查、排序、统计等功能
  - 支持数据持久化（二进制和 JSON 格式）

#### 3. 菜单系统 (`msystem.cpp`)
- **职责**：提供用户交互界面
- **功能**：实现各种操作的菜单界面和用户输入处理

### 数据持久化原理

#### 二进制格式存储
- **优点**：读写速度快，文件体积小
- **实现**：使用 `std::ofstream` 和 `std::ifstream` 进行二进制读写
- **格式**：
  ```
  [记录数量 (size_t)]
  [学生1: ID长度 | ID内容 | 姓名长度 | 姓名内容 | 年龄 | 成绩 | 班级类型]
  [学生2: ...]
  ...
  ```

#### JSON 格式存储
- **优点**：可读性强，易于数据交换
- **实现**：使用自定义 JSON 解析库进行序列化和反序列化
- **格式**：
  ```json
  {
    "students": [
      {
        "id": "202421011121",
        "name": "张三",
        "age": 20,
        "score": 95.5,
        "class": "CLASS_A"
      }
    ]
  }
  ```

### 线程安全机制

系统使用 `std::mutex` 保证多线程环境下的数据安全：
- 所有对 `students` 向量的操作都通过 `std::lock_guard` 加锁
- 支持批量添加时的多线程并发操作

---

## 🛠️ 实现方法

### 1. 项目构建系统

使用 **CMake** 作为构建系统：

```cmake
cmake_minimum_required(VERSION 3.10)
project("Student Information Management System")
set(CMAKE_CXX_STANDARD 11)
```

### 2. 目录结构

```
SIMS/
├── CMakeLists.txt          # CMake 构建配置
├── main/                   # 主程序目录
│   └── main.cpp           # 程序入口
├── src/                    # 源文件目录
│   ├── manager.cpp        # 管理器实现
│   ├── msystem.cpp        # 菜单系统实现
│   ├── student.cpp        # 学生类实现
│   └── utility.cpp        # 工具函数实现
├── include/                # 头文件目录
│   ├── manager.hpp        # 管理器接口
│   ├── msystem.hpp        # 菜单系统接口
│   ├── student.hpp         # 学生类接口
│   ├── utility.hpp         # 工具函数接口
│   └── json/              # JSON 库头文件
│       ├── myjson.hpp
│       ├── parsing.hpp
│       ├── serializing.hpp
│       └── utility.hpp
├── lib/                    # 库文件目录
│   └── libjson.a          # JSON 解析静态库
└── build/                  # 构建输出目录
    └── bin/
        └── sims            # 可执行文件
```

### 3. 关键实现细节

#### 文件路径管理
系统使用 `utility::getProjectRoot()` 函数自动检测项目根目录，确保所有数据文件（`student.dat`、`students.json`、`system.log`）都保存在项目根目录，无论从哪个目录运行程序。

#### 数据验证
- **ID 验证**：只允许字母和数字
- **姓名验证**：只允许字母、空格、连字符和下划线
- **年龄验证**：1-200 之间
- **成绩验证**：0-100 之间

#### 错误处理
- 使用异常处理机制捕获 JSON 解析错误
- 文件操作失败时返回错误信息
- 输入验证失败时提示用户重新输入

---

## 📁 项目结构

### 核心模块

1. **学生信息模块** (`student.hpp/cpp`)
   - 学生数据模型
   - 数据验证
   - 显示功能

2. **管理器模块** (`manager.hpp/cpp`)
   - 学生信息管理
   - 数据查询和排序
   - 统计分析
   - 数据持久化

3. **菜单系统模块** (`msystem.hpp/cpp`)
   - 用户界面
   - 用户输入处理
   - 操作菜单

4. **工具模块** (`utility.hpp/cpp`)
   - 数据验证函数
   - 日志记录
   - 项目路径检测

---

## 🚀 编译与运行

### 环境要求

- **操作系统**：Linux / macOS / Windows
- **编译器**：支持 C++11 标准的编译器（GCC 4.8+, Clang 3.3+, MSVC 2013+）
- **构建工具**：CMake 3.10 或更高版本

### 编译步骤

1. **克隆或下载项目**
   ```bash
   cd /path/to/SIMS
   ```

2. **创建构建目录并配置**
   ```bash
   cmake -B build
   ```

3. **编译项目**
   ```bash
   cmake --build build
   ```

4. **运行程序**
   ```bash
   ./build/bin/sims
   ```
   或者在 Windows 上：
   ```cmd
   build\bin\sims.exe
   ```

### 快速编译（一条命令）

```bash
cmake -B build && cmake --build build && ./build/bin/sims
```

---

## 📖 使用指南

### 启动系统

运行可执行文件后，系统会自动加载 `student.dat` 文件（如果存在）。主菜单会显示所有可用操作。

### 主菜单选项

```
========== Student Information Management System ==========
1.  Add new student                    # 添加新学生
2.  Delete student                     # 删除学生
3.  Update student's information       # 更新学生信息
4.  Search student by ID               # 按学号搜索
5.  Search student by name             # 按姓名搜索
6.  Search student by age              # 按年龄范围搜索
7.  Search student by score            # 按成绩范围搜索
8.  Sort by ID                         # 按学号排序
9.  Sort by name                       # 按姓名排序
10. Sort by age                        # 按年龄排序
11. Sort by score                      # 按成绩排序
12. Display all students' information # 显示所有学生
13. Statistical information            # 统计信息
14. Load data from JSON                # 从 JSON 加载
15. Save data to JSON                  # 保存为 JSON
16. Batch add student(multi threads)   # 批量添加（多线程）
17. Traversal                          # 遍历所有学生
0.  Exit the system                    # 退出系统
```

### 操作示例

#### 1. 添加学生

选择选项 `1`，然后按提示输入：
- **ID**：学号（唯一，只能包含字母和数字）
- **Name**：姓名（只能包含字母、空格、连字符和下划线）
- **Age**：年龄（1-200）
- **Score**：成绩（0-100）
- **Class**：班级（1-6 对应 CLASS_A 到 CLASS_F）

#### 2. 搜索学生

- **按学号搜索**（选项 4）：支持模糊搜索，输入部分学号即可
- **按姓名搜索**（选项 5）：支持模糊搜索，输入部分姓名即可
- **按年龄范围搜索**（选项 6）：输入最小和最大年龄
- **按成绩范围搜索**（选项 7）：输入最小和最大成绩

#### 3. 排序

选择排序选项（8-11），然后选择：
- `1`：升序
- `2`：降序

排序后会自动显示所有学生信息。

#### 4. 数据导入导出

- **从 JSON 加载**（选项 14）：输入 JSON 文件名（保存在项目根目录）
- **保存为 JSON**（选项 15）：输入文件名，默认 `students.json`

#### 5. 批量添加

选择选项 `16`，输入要添加的学生数量。系统会使用多线程自动生成随机学生信息。

### 退出系统

选择选项 `0` 退出。系统会自动保存数据到 `student.dat` 文件。

---

## ⚙️ 功能说明

### 1. 学生信息管理

#### 添加学生
- 验证输入数据的有效性
- 检查学号唯一性
- 添加成功后记录日志

#### 删除学生
- 根据学号删除
- 删除成功后记录日志

#### 更新学生
- 先搜索学生
- 显示当前信息
- 允许修改除学号外的所有信息

### 2. 查询功能

所有查询都支持：
- **精确匹配**：输入完整信息
- **模糊搜索**：输入部分信息（ID 和姓名）

查询结果以列表形式显示，包含所有匹配的学生信息。

### 3. 排序功能

支持四种排序方式，每种都支持升序和降序：
- **按学号**：字符串比较
- **按姓名**：字符串比较
- **按年龄**：数值比较
- **按成绩**：数值比较

### 4. 统计分析

显示以下统计信息：
- 学生总数
- 平均成绩
- 最高成绩
- 最低成绩

### 5. 数据持久化

#### 自动保存
- 程序启动时自动加载 `student.dat`
- 程序退出时自动保存到 `student.dat`

#### 手动导入导出
- 支持 JSON 格式的导入导出
- 所有文件保存在项目根目录

### 6. 批量操作

#### 批量添加
- 使用多线程并发添加
- 自动生成随机学生信息
- 保证线程安全

#### 遍历
- 使用回调函数遍历所有学生
- 支持自定义操作

---

## 🔒 技术特性

### 1. 线程安全
- 使用 `std::mutex` 保护共享数据
- 所有数据操作都加锁保护
- 支持多线程批量操作

### 2. 数据验证
- 输入数据格式验证
- 学号唯一性检查
- 数据范围验证

### 3. 错误处理
- 异常捕获和处理
- 文件操作错误处理
- 用户输入错误提示

### 4. 日志记录
- 所有操作都记录到 `system.log`
- 包含时间戳和操作详情
- 便于问题追踪和调试

### 5. 代码规范
- 使用 C++11 标准
- 面向对象设计
- 清晰的代码结构
- 完整的注释

---

## 📄 文件说明

### 数据文件

- **`student.dat`**：二进制格式的学生数据文件（自动保存/加载）
- **`students.json`**：JSON 格式的学生数据文件（手动导入/导出）
- **`system.log`**：系统操作日志文件

### 源代码文件

- **`main/main.cpp`**：程序入口，主循环
- **`src/manager.cpp`**：管理器实现，核心业务逻辑
- **`src/msystem.cpp`**：菜单系统实现，用户界面
- **`src/student.cpp`**：学生类实现
- **`src/utility.cpp`**：工具函数实现

### 头文件

- **`include/manager.hpp`**：管理器接口定义
- **`include/msystem.hpp`**：菜单系统接口定义
- **`include/student.hpp`**：学生类接口定义
- **`include/utility.hpp`**：工具函数接口定义

### 构建文件

- **`CMakeLists.txt`**：CMake 构建配置
- **`build/`**：构建输出目录（由 CMake 生成）

---

## 📝 注意事项

1. **数据备份**：重要数据请定期备份 `student.dat` 和 `students.json` 文件
2. **文件路径**：所有数据文件都保存在项目根目录，不要手动移动
3. **输入格式**：严格按照提示输入数据，避免格式错误
4. **学号唯一性**：系统不允许重复的学号，添加时会自动检查
5. **线程安全**：批量添加时使用多线程，系统会自动处理并发问题

---

## 🐛 常见问题

### Q: 程序启动时提示文件不存在？
A: 这是正常现象，首次运行时会创建新的数据文件。

### Q: 如何清空所有数据？
A: 删除项目根目录下的 `student.dat` 文件，重新启动程序。

### Q: JSON 文件无法加载？
A: 检查 JSON 文件格式是否正确，确保文件在项目根目录下。

### Q: 编译错误？
A: 确保 CMake 版本 >= 3.10，编译器支持 C++11 标准。

---

## 📧 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件

---

## 📜 许可证

本项目仅供学习和研究使用。

---

**最后更新**：2025年11月
